---
title: Vue RouteråŸºç¡€çŸ¥è¯†æ€»ç»“
date: 2021-05-07 20:16:35
summary: Vue Router V3.x åŸºç¡€çŸ¥è¯†
tags:
- Vue
- Vue Router
- é¢è¯•
categories:
- [å‰ç«¯è¿›é˜¶]
- [è¯»ä¹¦ç¬”è®°]
---

### 1. å¯¼èˆªå®ˆå«
- å…¨å±€å®ˆå«
  - `beforeEach` å…¨å±€å‰ç½®å®ˆå« 
  - `beforeResolve` å…¨å±€è§£æå®ˆå« 
  - `afterEach` å…¨å±€åç½®é’©å­
- è·¯ç”±ç‹¬äº«çš„å®ˆå« `beforeEnter`
- ç»„ä»¶å†…å®ˆå«
  - `beforeRouteEnter` ç»„ä»¶çš„å¯¹åº”è·¯ç”±è¢«éªŒè¯å‰è°ƒç”¨
  - `beforeRouteUpdate` åœ¨è·¯ç”±æ”¹å˜ä¸”ç»„ä»¶è¢«å¤ç”¨æ—¶è°ƒç”¨
  - `beforeRouteLeave` ç¦»å¼€æ¸²æŸ“ç»„ä»¶çš„å¯¹åº”è·¯ç”±æ—¶è°ƒç”¨


### 2. å¯¼èˆªå®ˆå«è§£ææµç¨‹
1. å¯¼èˆªè¢«è§¦å‘ã€‚
2. åœ¨å¤±æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ `beforeRouteLeave` å®ˆå«ã€‚
3. è°ƒç”¨å…¨å±€çš„ `beforeEach` å®ˆå«ã€‚
4. åœ¨é‡ç”¨çš„ç»„ä»¶é‡Œè°ƒç”¨ `beforeRouteUpdate` å®ˆå«(2.2+)ã€‚
5. åœ¨è·¯ç”±é…ç½®é‡Œè°ƒç”¨ `beforeEnter`ã€‚
6. è§£æå¼‚æ­¥è·¯ç”±ç»„ä»¶ã€‚
7. åœ¨è¢«æ¿€æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ `beforeRouteEnter`ã€‚
8. è°ƒç”¨å…¨å±€çš„ `beforeResolve` å®ˆå«(2.5+)ã€‚
9. å¯¼èˆªè¢«ç¡®è®¤ã€‚
10. è°ƒç”¨å…¨å±€çš„ `afterEach` é’©å­ã€‚
11. è§¦å‘ DOM æ›´æ–°ã€‚
12. è°ƒç”¨ `beforeRouteEnter` å®ˆå«ä¸­ä¼ ç»™ `next` çš„å›è°ƒå‡½æ•°ï¼Œåˆ›å»ºå¥½çš„ç»„ä»¶å®ä¾‹ä¼šä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ä¼ å…¥ã€‚

### 3. routeå’Œrouterçš„åŒºåˆ«
- `router` æ˜¯ `VueRouter` çš„å®ä¾‹ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€è·¯ç”±å¯¹è±¡ï¼ŒåŒ…å«äº†è·¯ç”±è·³è½¬çš„æ–¹æ³•ã€é’©å­å‡½æ•°ç­‰ã€‚
- `route` æ˜¯ä¸€ä¸ªå½“å‰æ­£åœ¨è·³è½¬çš„è·¯ç”±å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªè·¯ç”±éƒ½ä¼šæœ‰ä¸€ä¸ª`route`å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªå±€éƒ¨å¯¹è±¡ï¼ŒåŒ…å«`path`,`params`,`hash`,`query`,`fullPath`,`matched`,`name`ç­‰è·¯ç”±ä¿¡æ¯å‚æ•°ã€‚

### 4. è·¯ç”±æ¨¡å¼
#### Hashæ¨¡å¼
`Hash` æ¨¡å¼æ˜¯ä¸€ç§æŠŠå‰ç«¯è·¯ç”±çš„è·¯å¾„ç”¨ `#` æ‹¼æ¥åœ¨çœŸå® `url` åé¢çš„æ¨¡å¼ã€‚å½“ `#` åé¢çš„è·¯å¾„å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæµè§ˆå™¨å¹¶ä¸ä¼šé‡æ–°å‘èµ·è¯·æ±‚ï¼Œè€Œæ˜¯ä¼šè§¦å‘ `onhashchange` äº‹ä»¶ï¼Œ`Vue Router`ä¸­çš„Hashæ¨¡å¼å°±æ˜¯é€šè¿‡ç›‘å¬`onhashchange`äº‹ä»¶æ¥å®ç°çš„ã€‚

**ç‰¹ç‚¹ï¼š**
- hashå˜åŒ–ä¼šè§¦å‘ç½‘é¡µè·³è½¬ï¼Œå³æµè§ˆå™¨çš„å‰è¿›å’Œåé€€ã€‚
- hash å¯ä»¥æ”¹å˜ url ï¼Œä½†æ˜¯ä¸ä¼šè§¦å‘é¡µé¢é‡æ–°åŠ è½½ï¼ˆhashçš„æ”¹å˜æ˜¯è®°å½•åœ¨ window.history ä¸­ï¼‰ï¼Œå³ä¸ä¼šåˆ·æ–°é¡µé¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰é¡µé¢çš„è·³è½¬éƒ½æ˜¯åœ¨å®¢æˆ·ç«¯è¿›è¡Œæ“ä½œã€‚å› æ­¤ï¼Œè¿™å¹¶ä¸ç®—æ˜¯ä¸€æ¬¡ http è¯·æ±‚ï¼Œæ‰€ä»¥è¿™ç§æ¨¡å¼ä¸åˆ©äº SEO ä¼˜åŒ–ã€‚hash åªèƒ½ä¿®æ”¹ # åé¢çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥åªèƒ½è·³è½¬åˆ°ä¸å½“å‰ url åŒæ–‡æ¡£çš„ url ã€‚
- hash é€šè¿‡ window.onhashchange çš„æ–¹å¼ï¼Œæ¥ç›‘å¬ hash çš„æ”¹å˜ï¼Œå€Ÿæ­¤å®ç°æ— åˆ·æ–°è·³è½¬çš„åŠŸèƒ½ã€‚
- hash æ°¸è¿œä¸ä¼šæäº¤åˆ° server ç«¯ï¼ˆå¯ä»¥ç†è§£ä¸ºåªåœ¨å‰ç«¯è‡ªç”Ÿè‡ªç­ï¼‰ã€‚

####  Historyæ¨¡å¼
`history` API æ˜¯ HTML5 æä¾›çš„æ–°ç‰¹æ€§ï¼Œå…è®¸å¼€å‘è€…ç›´æ¥æ›´æ”¹å‰ç«¯è·¯ç”±ã€‚

`history`å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼š
- `length`: è¡¨ç¤ºå†å²è®°å½•ä¸­å…ƒç´ çš„æ•°é‡
- `state`: å½“å‰é¡µé¢çš„stateå¯¹è±¡
- `pushState()`ï¼šå¾€å†å²è®°å½•å †æ ˆé¡¶éƒ¨æ·»åŠ ä¸€æ¡è®°å½•ï¼Œä¼šè§¦å‘`onpopstate`äº‹ä»¶
- `replaceState()`ï¼šæ›´æ”¹å½“å‰çš„å†å²è®°å½•ï¼Œä¼šè§¦å‘`onpopstate`äº‹ä»¶
- `go()`ï¼šåˆ°è¾¾æŒ‡å®šå†å²è®°å½•
- `forward()`ï¼šé¡µé¢å‰è¿›ï¼Œç›¸å½“äº`go(1)`
- `back()`ï¼šé¡µé¢å›é€€ï¼Œç›¸å½“äº`go(-1)`

**ç‰¹ç‚¹ï¼š**
- æ–°çš„ url å¯ä»¥æ˜¯ä¸å½“å‰ url åŒæºçš„ä»»æ„ url ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸å½“å‰ url ä¸€æ ·çš„åœ°å€ï¼Œä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä¼šæŠŠé‡å¤çš„è¿™ä¸€æ¬¡æ“ä½œè®°å½•åˆ°æ ˆå½“ä¸­ã€‚
- é€šè¿‡ history.state ï¼Œæ·»åŠ ä»»æ„ç±»å‹çš„æ•°æ®åˆ°è®°å½•ä¸­ã€‚
- å¯ä»¥é¢å¤–è®¾ç½® title å±æ€§ï¼Œä»¥ä¾¿åç»­ä½¿ç”¨ã€‚
- é€šè¿‡ pushState ã€ replaceState æ¥å®ç°æ— åˆ·æ–°è·³è½¬çš„åŠŸèƒ½ã€‚

ğŸ’¡`history`æ¨¡å¼ä¼šå­˜åœ¨åˆ·æ–°æŠ¥404çš„é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„åº”ç”¨æ˜¯å•é¡µåº”ç”¨ï¼Œåˆ·æ–°çš„æ—¶å€™ä¼šå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè€Œè¯¥è·¯å¾„ä¸€èˆ¬æ˜¯æ— å¯¹åº”çš„æ–‡æ¡£èµ„æºçš„ï¼Œæ‰€ä»¥ä¼šæŠ¥404ï¼Œéœ€è¦æœåŠ¡å™¨ç«¯é…ç½®è¿”å›åŒä¸€ä¸ª`index.html`æ¥è§£å†³ã€‚

### 5. åŠ¨æ€è·¯ç”±å®ç°æƒé™æ§åˆ¶ 
1.é€šè¿‡ `router.beforeEach()`è¿›è¡Œæƒé™æ ¡éªŒï¼Œè·å–è§’è‰²å¯è®¿é—®çš„è·¯ç”±æ•°æ®ã€‚
2.é€šè¿‡ `vue-router` çš„ `addRoute()` æ¥åŠ¨æ€å¢åŠ è·¯ç”±ã€‚

### 6. ç»„ä»¶ä¸­ç›‘å¬è·¯ç”±å‚æ•°çš„å˜åŒ–
- `watch`
```js
// composition APIå†™æ³•
watch(() => route.query, (newValue) => {
  // ...
})
```
- `beforeRouteUpdate`
```js
beforeRouteUpdate (to, from, next) {
    // è¿™é‡Œç›‘å¬
},
```